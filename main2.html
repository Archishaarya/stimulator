<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asteroid Impact Simulator</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Orbitron', sans-serif;
    margin: 0;
    background: radial-gradient(circle at top, #0a0f24, #000);
    color: #f0f0f0;
}
h1, h2, h3 { text-align: center; color: #fff; }
.info-section, form, #results {
    background: rgba(0,0,0,0.7);
    padding: 20px;
    border-radius: 15px;
    margin: 20px auto;
    max-width: 900px;
}
label { display:block; margin:10px 0 5px; font-weight:bold; }
input, button {
    padding:10px;
    margin:5px 0;
    border:none;
    border-radius:8px;
    font-size:1rem;
}
input { width: 220px; }
button { cursor:pointer; transition:0.3s; color:#fff; }
button:hover { transform:scale(1.05); box-shadow:0 0 15px rgba(0,255,150,0.8); }
#sim-btn { background: #4CAF50; padding: 10px 20px; }
#mitigate-btn { background: #2196F3; padding: 10px 20px; }
#map { height:500px; width:90%; max-width:1000px; margin:0 auto; border:2px solid #333; border-radius:15px; }
.result-card {
    padding:10px;
    border-radius:10px;
    margin-top:10px;
    font-weight:bold;
    text-align:center;
}
.danger { background: rgba(255,0,0,0.3); border:1px solid red; color:#fff; }
.medium { background: rgba(255,165,0,0.3); border:1px solid orange; color:#fff; }
.low { background: rgba(0,255,0,0.3); border:1px solid lime; color:#000; }
#fact-box {
    background: rgba(0,255,255,0.2);
    border:1px solid #0ff;
    border-radius:10px;
    padding:15px;
    text-align:center;
    margin-top:10px;
    font-style:italic;
    color:#fff;
}
ul { line-height: 1.6; }
.meteor-trail {
    box-shadow: 0 0 10px orange, 0 0 20px red;
}
</style>
</head>
<body>

<!-- Educational info section -->
<div class="info-section">
    <h2>What Happens When a Meteor Hits Earth?</h2>
    <p>Meteors are more than just streaks of light in the night sky. When one makes it all the way to Earth, the results can be dramatic—or even catastrophic. The damage depends on a mix of surprising factors.</p>
    <h3>Here’s what really matters:</h3>
    <ul>
        <li><strong>Size & Speed:</strong> Bigger and faster meteors hit harder, releasing massive energy.</li>
        <li><strong>Angle of Entry:</strong> A steep dive can punch deep into the ground, while a shallow angle might cause an explosion in the sky.</li>
        <li><strong>What It’s Made Of:</strong> Rocky meteors often break apart before impact. Metallic ones are tougher and more destructive.</li>
        <li><strong>Where It Lands:</strong> An ocean impact could trigger tsunamis. A land strike might cause shockwaves, fires, or even global climate effects.</li>
        <li><strong>Atmospheric Effects:</strong> Some meteors explode mid-air, creating powerful shockwaves without ever touching the ground.</li>
        <li><strong>Environmental Fallout:</strong> Big impacts can throw dust into the atmosphere, blocking sunlight and cooling the planet—sometimes for years.</li>
    </ul>
</div>

<h1>🌌 Impactor 2025 Simulator</h1>
<p style="text-align:center;">Enter details below to simulate an asteroid impact and try mitigation!</p>

<form id="sim-form">
    <label for="size">Asteroid Size (meters diameter):</label>
    <input type="number" id="size" value="50" min="1" max="1000" required>

    <label for="speed">Speed (km/s):</label>
    <input type="number" id="speed" value="20" min="1" max="70" step="0.1" required>

    <label for="angle">Angle of Entry (degrees):</label>
    <input type="number" id="angle" value="45" min="0" max="90" step="1" required>

    <label for="deflection">Deflection Timing (seconds before impact):</label>
    <input type="number" id="deflection" value="0" min="0" step="1">

    <label for="density">Atmospheric Density (kg/m³):</label>
    <input type="number" id="density" value="1.225" step="0.01">

    <label for="lat">Impact Latitude:</label>
    <input type="number" id="lat" value="40.7" step="any" required>

    <label for="lon">Impact Longitude:</label>
    <input type="number" id="lon" value="-74" step="any" required>

    <button type="button" id="sim-btn" onclick="simulateImpact()">Simulate Impact</button>
    <button type="button" id="mitigate-btn" onclick="applyMitigation()" style="display:none;">Apply Mitigation</button>
</form>

<div id="map"></div>
<div id="results"></div>
<div id="fact-box">💡 Did You Know? The Chelyabinsk meteor in 2013 exploded with 30 times the energy of Hiroshima — yet never touched the ground.</div>

<script>
// Initialize map
const map = L.map('map').setView([40.7, -74], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let impactMarker, blastCircle, meteorLayer;
let originalSpeed = 0;
let currentResults = null;

// ✅ Fixed animateMeteor with correct radius reference
function animateMeteor(startLat, startLon, endLat, endLon, duration = 3000) {
    if (meteorLayer) map.removeLayer(meteorLayer);
    meteorLayer = L.circleMarker([startLat, startLon], {
        radius: 8,
        color: 'orange',
        fillColor: 'red',
        fillOpacity: 0.9,
        className: 'meteor-trail'
    }).addTo(map);

    let startTime = null;
    function step(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = Math.min((timestamp - startTime) / duration, 1);

        const currentLat = startLat + (endLat - startLat) * progress;
        const currentLon = startLon + (endLon - startLon) * progress;

        const opacity = 1 - progress;
        const radius = 8 * (1 - progress * 0.5);
        meteorLayer.setLatLng([currentLat, currentLon]);
        meteorLayer.setRadius(radius);
        meteorLayer.setStyle({ opacity: opacity, fillOpacity: opacity });

        if (progress < 1) {
            requestAnimationFrame(step);
        } else {
            meteorLayer.setStyle({ opacity: 0, fillOpacity: 0 });
            setTimeout(() => {
                if (meteorLayer) map.removeLayer(meteorLayer);
                meteorLayer = null;
                animateBlast(endLat, endLon, currentResults.radius); // ✅ Corrected
                setTimeout(() => showResultsFromData(currentResults), 1500);
            }, 500);
        }
    }
    requestAnimationFrame(step);
}

// ✅ Fixed animateBlast to keep circle fully visible
function animateBlast(lat, lon, maxRadius, duration = 1500) {
    if (blastCircle) map.removeLayer(blastCircle);
    const initialRadius = 100;
    blastCircle = L.circle([lat, lon], {
        color: 'red',
        fillColor: '#f03',
        fillOpacity: 0.9,
        radius: initialRadius,
        weight: 3
    }).addTo(map)
      .bindPopup('<b>Impact Site</b><br>Asteroid hits here!').openPopup();

    let startTime = null;
    function step(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = Math.min((timestamp - startTime) / duration, 1);

        const currentRadius = initialRadius + (maxRadius - initialRadius) * progress;
        const borderWeight = 3 - (1 * progress);

        blastCircle.setRadius(currentRadius);
        blastCircle.setStyle({
            fillOpacity: 0.9,
            opacity: 1,
            weight: borderWeight
        });

        if (progress < 1) {
            requestAnimationFrame(step);
        } else {
            blastCircle.setStyle({
                fillOpacity: 0.7,  // ✅ Persistent and fully visible
                opacity: 1,
                color: 'red',
                weight: 2
            });
        }
    }
    requestAnimationFrame(step);
}

function showResultsFromData(data) {
    const { size, speed, radius, lat, lon, energy, breakupStart, breakupAlt, residualV, airburst, crater, seismic, tsunami, damageLevel, casualties, levelClass } = data;
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = `
        <h3>Simulation Results</h3>
        <div class="result-card ${levelClass}">Damage Level: ${damageLevel}</div>
        <p><strong>Asteroid Size:</strong> ${size} m</p>
        <p><strong>Speed:</strong> ${speed} km/s</p>
        <p><strong>Impact Location:</strong> Lat ${lat}, Lon ${lon}</p>
        <p><strong>Estimated Blast Radius (Affected Area):</strong> ${(radius/1000).toFixed(1)} km</p>
        <p><strong>Energy Before Atmospheric Entry:</strong> ${energy} Mt TNT</p>
        <p><strong>Breakup Starts At:</strong> ${breakupStart} km</p>
        <p><strong>Breakup Altitude:</strong> ${breakupAlt} km</p>
        <p><strong>Residual Velocity:</strong> ${residualV} km/s</p>
        <p><strong>Energy of Airburst:</strong> ${airburst} Mt TNT</p>
        <p><strong>Crater Size (if formed):</strong> ${crater} km</p>
        <p><strong>Seismic Effects (Richter magnitude):</strong> ${seismic}</p>
        <p><strong>Probability of Tsunami:</strong> ${tsunami===1 ? 'High (Ocean Impact)' : 'Low (Land Impact)'}</p>
        <p><em>Note: This is a simplified model for educational purposes.</em></p>
    `;
    resultsDiv.style.display = 'block';
}

function simulateImpact() {
    const size = parseFloat(document.getElementById('size').value);
    const speed = parseFloat(document.getElementById('speed').value);
    const angle = parseFloat(document.getElementById('angle').value);
    const density = parseFloat(document.getElementById('density').value);
    const lat = parseFloat(document.getElementById('lat').value);
    const lon = parseFloat(document.getElementById('lon').value);

    originalSpeed = speed;

    if (impactMarker) map.removeLayer(impactMarker);
    if (blastCircle) map.removeLayer(blastCircle);
    if (meteorLayer) map.removeLayer(meteorLayer);
    document.getElementById('mitigate-btn').style.display = 'inline-block';
    document.getElementById('mitigate-btn').textContent = 'Apply Mitigation';
    document.getElementById('results').innerHTML = '';
    document.getElementById('results').style.display = 'none';

    const radius_m = size / 2;
    const meteorDensity = 3000;
    const mass = (4/3) * Math.PI * radius_m**3 * meteorDensity;
    const velocity = speed * 1000;
    const energy_joules = 0.5 * mass * velocity**2;
    const energy_mt = energy_joules / 4.184e15;

    const breakupStartAlt = 30 * (speed/20) * Math.cos(angle*Math.PI/180);
    const breakupAlt = breakupStartAlt*0.7;
    const residualVelocity = velocity*0.7;
    const airburstEnergy = energy_mt*0.3;
    const craterSize = (breakupAlt>0 ? 0 : 0.01*energy_mt**(1/3));
    const seismicEffect = Math.log10(energy_joules)/1.5 - 3;
    const tsunamiProb = (lat && lon && Math.random()>0.5 ? 1 : 0);
    const blastRadius = size*1000;

    let damageLevel='Low', casualties='Few';
    let levelClass = 'low';
    if(blastRadius>100000) { damageLevel='High'; casualties='Thousands'; levelClass='danger'; }
    else if(blastRadius>50000) { damageLevel='Medium'; casualties='Hundreds'; levelClass='medium'; }

    currentResults = {
        size, speed, radius: blastRadius, lat, lon,
        energy: energy_mt.toFixed(2), breakupStart: breakupStartAlt.toFixed(1),
        breakupAlt: breakupAlt.toFixed(1), residualV: (residualVelocity/1000).toFixed(1),
        airburst: airburstEnergy.toFixed(2), crater: craterSize.toFixed(2),
        seismic: seismicEffect.toFixed(2), tsunami: tsunamiProb,
        damageLevel, levelClass
    };

    const approachDistance = 1.5;
    const startLat = lat - (approachDistance * Math.cos((90 - angle) * Math.PI / 180));
    const startLon = lon - (approachDistance * Math.sin((90 - angle) * Math.PI / 180) * 0.5);

    map.setView([lat, lon], 6);
    animateMeteor(startLat, startLon, lat, lon);
}

function applyMitigation() {
    const speed = originalSpeed*0.5;
    document.getElementById('speed').value = speed;
    simulateImpact();
}
</script>
</body>
</html>